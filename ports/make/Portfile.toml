# Portfile.toml -- GNU Make for VeridianOS
#
# GNU Make is the standard build automation tool. It reads Makefiles to
# determine how to build programs and libraries. Required by nearly every
# autotools-based package in the bootstrap chain.

[port]
name = "make"
version = "4.4.1"
description = "GNU Make -- build automation tool"
homepage = "https://www.gnu.org/software/make/"
license = "GPL-3.0-or-later"
category = "devel"
build_type = "autotools"

[sources]
urls = ["https://ftp.gnu.org/gnu/make/make-4.4.1.tar.gz"]
checksums = ["dd16fb1d67bfab79a72f5e8390735c49e3e8e70b4945a15ab1f81ddb78658fb3"]

[dependencies]
build = []
runtime = []

[build]
steps = [
    "./configure --host=x86_64-veridian --prefix=/usr --disable-nls --without-guile",
    "make -j$(nproc)",
    "make install DESTDIR=$PKG_DIR"
]

# ---------------------------------------------------------------------------
# Native (static) cross-compilation build.
#
# Produces a statically linked `make` binary that runs on VeridianOS.
# Uses Canadian cross-compilation: build=linux, host=veridian.
#
# Build script: scripts/build-native-make.sh
# ---------------------------------------------------------------------------
[native_build]
description = "Static GNU Make for VeridianOS (cross-compiled from Linux)"
method = "canadian-cross"
script = "scripts/build-native-make.sh"
configure_flags = [
    "--build=x86_64-pc-linux-gnu",
    "--host=x86_64-veridian",
    "--prefix=/usr",
    "--disable-nls",
    "--without-guile",
]
env = { LDFLAGS = "-static", CFLAGS = "-O2 -static" }
notes = """
GNU Make is statically linked because VeridianOS has no dynamic linker.
Guile support is disabled to avoid the Guile dependency chain.
NLS is disabled since VeridianOS does not yet have locale support.
"""
