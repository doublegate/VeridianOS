%%{init: {
  "theme": "base",
  "themeVariables": {
    "fontFamily": "ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial",
    "fontSize": "14px",
    "primaryTextColor": "#0f172a",
    "lineColor": "#1f2937"
  },
  "flowchart": { "curve": "basis", "nodeSpacing": 60, "rankSpacing": 70 }
}}%%

flowchart TB

  %% =========================
  %% Kernel Entry Points
  %% =========================

  BOOT["Firmware / Bootloader<br>initial control transfer"]

  USER["Userland Process<br>constrained - no ambient authority"]

  HW["Hardware / Devices<br>asynchronous events"]

  KERNEL["Kernel - TCB<br>sole authority origin<br>isolation - mediation - validation"]

  VALIDATE[["Boundary Validation<br>capability check<br>endpoint validation<br>memory ownership rules"]]

  %% --- Entry paths ---
  BOOT -->|boot entry| KERNEL
  USER -->|syscall entry| KERNEL
  HW   -->|interrupt / exception entry| KERNEL

  %% --- Mediation ---
  KERNEL --> VALIDATE
  VALIDATE --> KERNEL

  %% --- Styling ---
  classDef kernel fill:#dbeafe,stroke:#6b7280,stroke-width:2px
  classDef user fill:#d1fae5,stroke:#6b7280,stroke-width:2px
  classDef boot fill:#e8eaed,stroke:#6b7280,stroke-width:2px
  classDef hw fill:#ede9fe,stroke:#6b7280,stroke-width:2px
  classDef validate fill:#ffffff,stroke:#cbd5e1,stroke-width:2px

  class KERNEL kernel
  class USER user
  class BOOT boot
  class HW hw
  class VALIDATE validate
