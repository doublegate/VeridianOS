<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="900" viewBox="0 0 1400 900" role="img" aria-label="VeridianOS Architecture Diagram">
  <defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#1f2937"/>
    </marker>

    <style>
      /* Transparent background by default (SVG). */
      .font-title { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; font-size: 24px; font-weight: 800; fill: #0f172a; }
      .font-sub   { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; font-size: 14px; fill: #334155; }
      .font-h     { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; font-size: 16px; font-weight: 800; fill: #0f172a; }
      .font-t     { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; font-size: 13px; fill: #0f172a; }
      .font-s     { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; font-size: 12px; fill: #334155; }

      .frame { fill: rgba(15,23,42,0.02); stroke: #0f172a; stroke-opacity: 0.28; stroke-width: 2; rx: 18; ry: 18; }
      .box   { stroke: #0f172a; stroke-opacity: 0.32; stroke-width: 2; rx: 14; ry: 14; }
      .box-kernel   { fill: rgba(59,130,246,0.10); }
      .box-userland { fill: rgba(16,185,129,0.10); }
      .box-svc      { fill: rgba(245,158,11,0.12); }
      .box-driver   { fill: rgba(168,85,247,0.10); }
      .box-boot     { fill: rgba(100,116,139,0.10); }

      /* IPC is a channel overlay, not an actor node */
      .ipc-channel { fill: rgba(14,165,233,0.06); stroke: rgba(14,165,233,0.45); stroke-width: 2; stroke-dasharray: 10 8; rx: 18; ry: 18; }

      .box-note { fill: rgba(15,23,42,0.03); stroke: rgba(15,23,42,0.22); stroke-width: 2; stroke-dasharray: 10 8; rx: 14; ry: 14; }

      .arrow { stroke: #1f2937; stroke-width: 2.2; fill: none; marker-end: url(#arrow); stroke-linecap: round; stroke-linejoin: round; }
      .arrow-muted { stroke: #475569; stroke-width: 2; fill: none; marker-end: url(#arrow); stroke-linecap: round; stroke-linejoin: round; }
      .arrow-dashed { stroke: #475569; stroke-width: 2; fill: none; marker-end: url(#arrow); stroke-dasharray: 8 6; stroke-linecap: round; stroke-linejoin: round; }

      /* Label halo text (no blocking boxes). */
      .label { fill: #334155; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; font-size: 12px; font-weight: 800;
               paint-order: stroke; stroke: rgba(255,255,255,0.95); stroke-width: 5; }

      .legend-box { fill: rgba(255,255,255,0.62); stroke: rgba(15,23,42,0.22); stroke-width: 2; rx: 14; ry: 14; }
    </style>
  </defs>

  <!-- Title -->
  <text x="40" y="52" class="font-title">VeridianOS Architecture (Normative)</text>
  <text x="40" y="78" class="font-sub">Layered structure + explicit authority flow. Capabilities originate in the kernel; all cross-boundary interaction is mediated.</text>

  <!-- System boundary -->
  <rect x="30" y="110" width="1340" height="760" class="frame"/>
  <text x="50" y="138" class="font-h">System Boundary</text>
  <text x="230" y="138" class="font-s">Isolation boundaries are architectural (I-5). Authority is explicit (I-1).</text>

  <!-- Top row: Boot -> Kernel -> Drivers -->
  <rect x="70" y="170" width="320" height="120" class="box box-boot"/>
  <text x="92" y="202" class="font-h">Firmware / Bootloader</text>
  <text x="92" y="226" class="font-t">Boot-time entry establishes kernel control</text>
  <text x="92" y="248" class="font-s">Bounded trust assumptions; early boot is part of TCB</text>

  <rect x="440" y="160" width="520" height="270" class="box box-kernel"/>
  <text x="462" y="192" class="font-h">Kernel (TCB)</text>
  <text x="462" y="216" class="font-t">Enforces isolation, mediates capabilities, manages memory ownership</text>
  <text x="462" y="238" class="font-s">Entry points: boot, interrupts/exceptions, syscalls</text>
  <text x="462" y="260" class="font-s">TCB minimal (I-14). Kernel authority deliberate (I-15).</text>

  <rect x="462" y="288" width="476" height="122" class="box" style="fill: rgba(255,255,255,0.62); stroke-opacity: 0.22;"/>
  <text x="482" y="316" class="font-t"><tspan font-weight="800">Capability Authority</tspan>: create / validate / transfer / revoke</text>
  <text x="482" y="340" class="font-s">Unforgeable (I-2), minimal scope (I-3), no confused deputies (I-4)</text>
  <text x="482" y="362" class="font-s">Memory ownership explicit (I-8), lifetime enforced (I-10), no aliasing (I-9)</text>
  <text x="482" y="384" class="font-s">Unsafe is exceptional + invariant-bound (I-11–I-13)</text>

  <rect x="1010" y="170" width="320" height="150" class="box box-driver"/>
  <text x="1032" y="202" class="font-h">Drivers</text>
  <text x="1032" y="226" class="font-t">Hardware access behind explicit privilege boundaries</text>
  <text x="1032" y="248" class="font-t">No bypass of kernel mediation</text>
  <text x="1032" y="270" class="font-s">Constrained hardware capabilities; hardware not implicitly trusted</text>

  <!-- Middle row: Services -->
  <rect x="1010" y="380" width="320" height="220" class="box box-svc"/>
  <text x="1032" y="412" class="font-h">Services</text>
  <text x="1032" y="436" class="font-t">Capability-mediated system functionality</text>
  <text x="1032" y="458" class="font-t">Act as capability routers, not authorities</text>
  <text x="1032" y="480" class="font-t">May fail independently (failure contained)</text>
  <text x="1032" y="504" class="font-s">Delegation is explicit; no ambient authority</text>

  <!-- Bottom row: Userland -->
  <rect x="440" y="470" width="520" height="200" class="box box-userland"/>
  <text x="462" y="502" class="font-h">Userland</text>
  <text x="462" y="526" class="font-t">Intentionally constrained processes</text>
  <text x="462" y="548" class="font-t">No ambient authority; access only via capabilities</text>
  <text x="462" y="570" class="font-t">Isolation by default</text>
  <text x="462" y="594" class="font-s">Userland → syscalls/IPC → kernel mediation</text>

  <!-- IPC channel overlay (covers userland<->services corridor) -->
  <rect x="70" y="350" width="890" height="340" class="ipc-channel"/>
  <text x="92" y="382" class="font-h">IPC Channel (Capability-Mediated)</text>
  <text x="92" y="406" class="font-t">Transport, not an authority source</text>
  <text x="92" y="428" class="font-s">Endpoints are capabilities; transfer is kernel-mediated; message passing is default.</text>
  <text x="92" y="450" class="font-s">Shared memory requires explicit setup.</text>

  <!-- Shared memory note -->
  <rect x="70" y="705" width="1260" height="120" class="box-note"/>
  <text x="92" y="738" class="font-h">Shared Memory (Exceptional)</text>
  <text x="92" y="762" class="font-t">Shared regions are capability-governed with explicit lifetime.</text>
  <text x="92" y="784" class="font-s">Deliberate aliasing only (I-9). Message passing remains default IPC mechanism.</text>

  <!-- Flow arrows (actors only; IPC is channel overlay) -->

  <!-- boot -> kernel -->
  <path d="M 390 230 L 420 230 L 420 220 L 440 220" class="arrow"/>
  <text x="372" y="160" class="label">boot entry</text>

  <!-- userland -> kernel (syscalls) -->
  <path d="M 700 470 L 700 450 L 700 430" class="arrow"/>
  <text x="712" y="446" class="label">syscalls</text>

  <!-- kernel -> drivers (hardware caps) -->
  <path d="M 960 240 L 990 240 L 990 245 L 1010 245" class="arrow"/>
  <text x="915" y="210" class="label">hardware caps</text>

  <!-- drivers -> kernel (interrupt/exception entry) -->
  <path d="M 1010 290 L 990 290 L 990 270 L 960 270" class="arrow-muted"/>
  <text x="972" y="318" class="label">interrupt/exception entry</text>

  <!-- kernel -> services (service caps) -->
  <path d="M 960 350 L 990 350 L 990 430 L 1010 430" class="arrow"/>
  <text x="915" y="330" class="label">service caps</text>

  <!-- services -> kernel (capability transfer request; kernel-mediated IPC) -->
  <path d="M 1010 520 L 990 520 L 990 560 L 960 560" class="arrow-dashed"/>
  <text x="885" y="575" class="label">cap transfer (request)</text>

  <!-- kernel -> userland (capability transfer delivery) -->
  <path d="M 960 560 L 900 560 L 900 610 L 820 610 L 820 630" class="arrow-dashed"/>
  <text x="740" y="650" class="label">cap transfer (delivery)</text>

  <!-- endpoint validation shown as kernel-internal mediation label on syscall/IPC boundary -->
  <path d="M 600 430 L 600 410 L 520 410" class="arrow-muted"/>
  <text x="430" y="414" class="label">endpoint + cap validation</text>

  <!-- Legend -->
  <rect x="1010" y="620" width="320" height="140" class="legend-box"/>
  <text x="1032" y="650" class="font-h">Legend</text>
  <line x1="1032" y1="678" x2="1120" y2="678" class="arrow"/>
  <text x="1130" y="682" class="font-s">authority grant / mediation</text>
  <line x1="1032" y1="706" x2="1120" y2="706" class="arrow-dashed"/>
  <text x="1130" y="710" class="font-s">explicit delegation (kernel-mediated)</text>
  <line x1="1032" y1="734" x2="1120" y2="734" class="arrow-muted"/>
  <text x="1130" y="738" class="font-s">asynchronous entry / boundary checks</text>
</svg>
